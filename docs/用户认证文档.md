用户认证接口文档
接口概览
方法	路径	描述	是否需要认证
POST	/api/v1/auth/register/account	账号密码注册	否
POST	/api/v1/auth/login/account	账号密码登录	否
POST	/api/v1/auth/register/mobile	手机号注册	否
POST	/api/v1/auth/login/mobile/verify	手机验证码登录	否
POST	/api/v1/auth/login/mobile/quick	手机号快捷登录	否
POST	/api/v1/auth/wechat/login-url	获取微信登录URL	否
POST	/api/v1/auth/wechat/callback	微信登录回调	否
POST	/api/v1/auth/logout	用户登出	是
POST	/api/v1/auth/refresh	刷新令牌	否
GET	/api/v1/auth/profile	获取用户信息	是
接口详情
1. 账号密码注册
POST /api/v1/auth/register/account

描述: 使用账号密码进行注册

请求头:

text
Content-Type: application/json
请求体:

json
{
  "username": "john_doe",
  "email": "john@example.com",
  "mobile": "13800138000", // 可选
  "password": "P@ssw0rd123!",
  "confirm_password": "P@ssw0rd123!",
  "nickname": "John", // 可选
  "avatar": "https://example.com/avatar.jpg" // 可选
}
参数验证:

username: 必填，3-20字符，只能包含字母、数字、下划线

email: 必填，有效邮箱格式

mobile: 可选，11位手机号（中国）

password: 必填，8-32字符，必须包含大小写字母、数字、特殊字符

confirm_password: 必填，必须与password一致

成功响应 (201 Created):

json
{
  "code": 201,
  "message": "注册成功",
  "data": {
    "user": {
      "id": "usr_1234567890",
      "username": "john_doe",
      "email": "john@example.com",
      "mobile": "13800138000",
      "nickname": "John",
      "avatar": "https://example.com/avatar.jpg",
      "is_active": true,
      "created_at": "2024-01-15T10:30:00Z"
    },
    "tokens": {
      "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "token_type": "Bearer",
      "expires_in": 3600
    }
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
错误响应:

400 Bad Request (参数验证失败):

json
{
  "code": 400,
  "message": "参数验证失败",
  "errors": {
    "username": ["用户名已存在"],
    "email": ["邮箱格式不正确"]
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
409 Conflict (用户已存在):

json
{
  "code": 409,
  "message": "用户已存在",
  "data": {
    "field": "email",
    "value": "john@example.com"
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
429 Too Many Requests (注册频率限制):

json
{
  "code": 429,
  "message": "注册尝试过于频繁，请5分钟后再试",
  "retry_after": 300,
  "timestamp": "2024-01-15T10:30:00Z"
}
2. 账号密码登录
POST /api/v1/auth/login/account

描述: 使用账号密码进行登录

请求体:

json
{
  "account": "john@example.com", // 可以是邮箱、用户名或手机号
  "password": "P@ssw0rd123!",
  "remember_me": true // 可选，默认为false
}
成功响应 (200 OK):

json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "user": {
      "id": "usr_1234567890",
      "username": "john_doe",
      "email": "john@example.com",
      "mobile": "13800138000",
      "nickname": "John",
      "avatar": "https://example.com/avatar.jpg",
      "is_active": true,
      "last_login": "2024-01-15T10:30:00Z"
    },
    "tokens": {
      "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "token_type": "Bearer",
      "expires_in": 7200 // remember_me=true时为7天，否则2小时
    }
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
错误响应:

401 Unauthorized (账号或密码错误):

json
{
  "code": 401,
  "message": "账号或密码错误",
  "data": {
    "remaining_attempts": 4, // 剩余尝试次数
    "lock_until": null // 锁定时间，如果被锁定
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
403 Forbidden (账户被锁定):

json
{
  "code": 403,
  "message": "账户已被锁定，请30分钟后再试",
  "data": {
    "lock_until": "2024-01-15T11:00:00Z",
    "remaining_time": 1800 // 剩余秒数
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
404 Not Found (用户不存在):

json
{
  "code": 404,
  "message": "用户不存在",
  "data": {
    "account": "john@example.com"
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
3. 手机号注册
POST /api/v1/auth/register/mobile

描述: 使用手机号和验证码进行注册

请求体:

json
{
  "mobile": "13800138000",
  "verify_code": "123456",
  "password": "P@ssw0rd123!", // 可选，如果不传则创建无密码账户
  "nickname": "手机用户", // 可选
  "invite_code": "ABCD1234" // 可选，邀请码
}
成功响应 (201 Created):

json
{
  "code": 201,
  "message": "注册成功",
  "data": {
    "user": {
      "id": "usr_1234567890",
      "mobile": "13800138000",
      "nickname": "手机用户",
      "has_password": false,
      "is_active": true,
      "created_at": "2024-01-15T10:30:00Z"
    },
    "tokens": {
      "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "token_type": "Bearer",
      "expires_in": 3600
    }
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
错误响应:

400 Bad Request (验证码错误):

json
{
  "code": 400,
  "message": "验证码错误或已过期",
  "data": {
    "mobile": "13800138000",
    "remaining_attempts": 2 // 剩余验证次数
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
409 Conflict (手机号已注册):

json
{
  "code": 409,
  "message": "手机号已注册",
  "data": {
    "mobile": "13800138000",
    "registered_at": "2024-01-10T09:00:00Z"
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
4. 手机验证码登录
POST /api/v1/auth/login/mobile/verify

描述: 使用手机号和验证码进行登录

请求体:

json
{
  "mobile": "13800138000",
  "verify_code": "123456"
}
成功响应 (200 OK):

json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "user": {
      "id": "usr_1234567890",
      "mobile": "13800138000",
      "username": "john_doe",
      "email": "john@example.com",
      "nickname": "John",
      "has_password": true,
      "is_active": true,
      "last_login": "2024-01-15T10:30:00Z"
    },
    "tokens": {
      "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "token_type": "Bearer",
      "expires_in": 3600
    }
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
错误响应:

400 Bad Request (验证码错误):

json
{
  "code": 400,
  "message": "验证码错误或已过期",
  "data": {
    "mobile": "13800138000",
    "remaining_attempts": 2
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
404 Not Found (手机号未注册):

json
{
  "code": 404,
  "message": "手机号未注册",
  "data": {
    "mobile": "13800138000",
    "suggestion": "请先注册或使用其他登录方式"
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
5. 手机号快捷登录（一键登录）
POST /api/v1/auth/login/mobile/quick

描述: 使用运营商一键登录（本机号码验证）

请求体:

json
{
  "access_token": "运营商返回的access_token",
  "operator": "ctcc", // cmcc: 移动, cucc: 联通, ctcc: 电信
  "device_id": "device_123456",
  "client_ip": "192.168.1.100"
}
成功响应 (200 OK):

json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "user": {
      "id": "usr_1234567890",
      "mobile": "13800138000",
      "username": "john_doe",
      "email": "john@example.com",
      "nickname": "John",
      "is_new_user": false, // true表示新用户首次登录
      "is_active": true,
      "last_login": "2024-01-15T10:30:00Z"
    },
    "tokens": {
      "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "token_type": "Bearer",
      "expires_in": 3600
    }
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
错误响应:

400 Bad Request (运营商验证失败):

json
{
  "code": 400,
  "message": "运营商验证失败",
  "data": {
    "operator": "ctcc",
    "error_code": "1001",
    "error_msg": "access_token无效"
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
6. 获取微信登录URL
POST /api/v1/auth/wechat/login-url

描述: 获取微信登录的跳转URL

请求体:

json
{
  "redirect_uri": "https://app.example.com/auth/callback",
  "state": "custom_state_123", // 可选，用于防CSRF
  "scope": "snsapi_userinfo", // 可选，snsapi_base或snsapi_userinfo
  "lang": "zh_CN" // 可选，语言
}
成功响应 (200 OK):

json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "auth_url": "https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx123456&redirect_uri=https://app.example.com/auth/callback&response_type=code&scope=snsapi_userinfo&state=custom_state_123#wechat_redirect",
    "expires_in": 300, // URL有效时间（秒）
    "state": "custom_state_123"
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
7. 微信登录回调
POST /api/v1/auth/wechat/callback

描述: 处理微信登录回调

请求体:

json
{
  "code": "0812abc123def456",
  "state": "custom_state_123"
}
成功响应 (200 OK):

json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "user": {
      "id": "usr_1234567890",
      "wechat_unionid": "o6_bmasdasdsad6_2sgVt7hMZOPfL",
      "wechat_openid": "oxWX5wEw8J8p1l1j1Q1q1q1q1q1q1",
      "nickname": "微信用户",
      "avatar": "https://thirdwx.qlogo.cn/mmopen/vi_32/xxx",
      "is_new_user": true,
      "is_active": true,
      "last_login": "2024-01-15T10:30:00Z"
    },
    "tokens": {
      "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "token_type": "Bearer",
      "expires_in": 3600
    },
    "need_bind": true, // 是否需要绑定手机号或邮箱
    "bind_options": ["mobile", "email"] // 可选的绑定方式
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
错误响应:

400 Bad Request (微信授权失败):

json
{
  "code": 400,
  "message": "微信授权失败",
  "data": {
    "error_code": "40029",
    "error_msg": "invalid code"
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
404 Not Found (微信账号未绑定):

json
{
  "code": 404,
  "message": "微信账号未绑定系统账户",
  "data": {
    "wechat_openid": "oxWX5wEw8J8p1l1j1Q1q1q1q1q1q1",
    "suggestion": "请先绑定手机号或邮箱"
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
8. 用户登出
POST /api/v1/auth/logout

描述: 用户登出，使令牌失效

请求头:

text
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
请求体:

json
{
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...", // 可选
  "logout_all": false // 可选，是否登出所有设备
}
成功响应 (200 OK):

json
{
  "code": 200,
  "message": "登出成功",
  "data": {
    "logout_count": 1, // 登出的设备数量
    "remaining_sessions": 2 // 剩余的活跃会话数
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
错误响应:

401 Unauthorized (无效令牌):

json
{
  "code": 401,
  "message": "无效的访问令牌",
  "timestamp": "2024-01-15T10:30:00Z"
}
9. 刷新令牌
POST /api/v1/auth/refresh

描述: 使用刷新令牌获取新的访问令牌

请求头:

text
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
请求体:

json
{
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
成功响应 (200 OK):

json
{
  "code": 200,
  "message": "令牌刷新成功",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...", // 新的刷新令牌
    "token_type": "Bearer",
    "expires_in": 3600
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
错误响应:

400 Bad Request (刷新令牌无效):

json
{
  "code": 400,
  "message": "刷新令牌无效或已过期",
  "timestamp": "2024-01-15T10:30:00Z"
}
401 Unauthorized (访问令牌无效):

json
{
  "code": 401,
  "message": "访问令牌无效",
  "timestamp": "2024-01-15T10:30:00Z"
}
10. 获取用户信息
GET /api/v1/auth/profile

描述: 获取当前登录用户的信息

请求头:

text
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
成功响应 (200 OK):

json
{
  "code": 200,
  "message": "获取成功",
  "data": {
    "user": {
      "id": "usr_1234567890",
      "username": "john_doe",
      "email": "john@example.com",
      "mobile": "13800138000",
      "nickname": "John",
      "avatar": "https://example.com/avatar.jpg",
      "gender": 1, // 0: 未知, 1: 男, 2: 女
      "birthday": "1990-01-01",
      "bio": "个人简介",
      "is_email_verified": true,
      "is_mobile_verified": true,
      "is_active": true,
      "created_at": "2024-01-10T09:00:00Z",
      "updated_at": "2024-01-15T10:30:00Z",
      "last_login": "2024-01-15T10:30:00Z"
    },
    "bindings": {
      "wechat": true,
      "qq": false,
      "weibo": false
    },
    "statistics": {
      "login_count": 42,
      "continuous_login_days": 7
    }
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
错误响应:

401 Unauthorized (未认证):

json
{
  "code": 401,
  "message": "未授权访问",
  "timestamp": "2024-01-15T10:30:00Z"
}
404 Not Found (用户不存在):

json
{
  "code": 404,
  "message": "用户不存在或已被删除",
  "timestamp": "2024-01-15T10:30:00Z"
}
通用错误响应
404 Not Found (资源不存在)
json
{
  "code": 404,
  "message": "请求的资源不存在",
  "data": {
    "resource": "/api/v1/auth/invalid-endpoint",
    "method": "POST"
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
500 Internal Server Error
json
{
  "code": 500,
  "message": "服务器内部错误",
  "request_id": "req_1234567890",
  "timestamp": "2024-01-15T10:30:00Z"
}
503 Service Unavailable
json
{
  "code": 503,
  "message": "服务暂时不可用",
  "data": {
    "reason": "系统维护",
    "estimated_recovery": "2024-01-15T12:00:00Z"
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
状态码说明
状态码	说明
200	请求成功
201	创建成功
400	客户端请求错误
401	未授权/认证失败
403	禁止访问
404	资源不存在
409	资源冲突
429	请求过于频繁
500	服务器内部错误
503	服务不可用
安全注意事项
密码安全:

密码必须加密传输（HTTPS）

密码强度要求：8-32位，包含大小写字母、数字、特殊字符

密码错误锁定机制：5次错误尝试后锁定30分钟

验证码安全:

验证码有效期：5分钟

验证码尝试次数：最多3次

验证码发送频率限制：60秒内只能发送1次

令牌安全:

访问令牌有效期：2小时（普通）或7天（记住我）

刷新令牌有效期：30天

支持令牌黑名单

支持多设备同时登录管理

防止滥用:

IP频率限制：每个IP每分钟最多10次请求

用户频率限制：每个用户每分钟最多5次登录尝试

验证码图形验证：连续失败后需要图形验证码

版本说明
当前版本: v1.0

最后更新: 2024-01-15

变更历史:

v1.0 (2024-01-15): 初始版本，支持多种登录方式

